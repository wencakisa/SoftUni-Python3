<html>
<head>
<meta charset="utf-8">
</head>
<body>
<h1 class="title">
10. HTTP; Задачи
</h1>
<div class="content lecture-content fix-links" data-fix-links-template="/student/lecture/assignment/%40/?back=%2Fstudent%2Flecture%2F56801680131b1642fba7379d%2F">
<h2 id="-http-">Какво е HTTP?</h2>
<p><a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP</a> е текстов протокол за пренос на информация, чрез който работи web, както и много услуги и системи в Интернет. Създаден през '90-те години, основната идея на HTTP остава непроменена и до днес. Актуалната, и най-често използвана версия на протокола в момента е 1.1.</p>
<p>Протоколът се основава на просто взаимодействие между клиент и сървър, които комуникират с текстови команди, което прави протокола използваем от практически всякакви платформи, и лесно четим. <strong>Клиентът</strong> изпраща заявка, а <strong>сървърът</strong> връща отговор на заявката.</p>
<blockquote>
<p>В примерите по-долу: <code>⏎</code> - край на ред - <code>\n</code></p>
</blockquote>
<h4 id="-">Заявка от клиента:</h4>
<p><strong>(1)</strong> Клиентът установява мрежова връзка от клиента до сървъра;</p>
<p><strong>(2)</strong> Изпраща в текстов вид HTTP заявка. Най-простата HTTP заявка, валидна за версия 1.1 на протокола, е:</p>
<pre><code>GET /about.html HTTP/1.1⏎
Host: python3.softuni.bg⏎
⏎
</code></pre><p><strong>(3)</strong> Изчаква се отговор на заявката от сървъра</p>
<h4 id="-">Отговор от сървъра:</h4>
<p><strong>(4)</strong> Сървърът връща отговор на заявката</p>
<pre><code>HTTP/1.1 200 OK⏎
Server: nginx/1.6.2 (Ubuntu)⏎
Content-Type: text/html; charset=UTF-8⏎
Content-Length: 3336⏎
. . . .
⏎
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Таковата&lt;/title&gt;
        . . . . . 
    &lt;/head&gt;
    &lt;body&gt;
        . . . . . . . . . . . . . .
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><strong>(5)</strong> В зависимост от конфигурацията и изискванията на клиента, сървърът или прекъсва мрежовата връзка, или изчаква за последващи заявки от клиента.</p>
<h2 id="http-">HTTP заявка</h2>
<pre><code>          +-----------------------------  Метод             
          |                                                 
          |   +---------+---------------  URI               
          |   |         |                                   
          |   |         |     +---------  Протокол          
          |   |         |     |                             
          |   |         |     |    +----  Нов ред           
          v   |         |     v    v                        

         GET  /index.html  HTTP/1.1⏎                        
|------&gt; Host:  example.com⏎                                
|        Agent: user-agent:Mozilla/5.0 (Macintosh;...⏎      
|------&gt; Header-Name: Value                                 
|  +---&gt; ⏎                                                  
|  |                                                        
|  |                                                        
|  |                                                        
|  Празен ред                                               
|                                                           
Headers
</code></pre><h3 id="-">Метод</h3>
<p>Методът указва каква операция трябва да бъде изпълнена. Най-често използваните методи са:</p>
<ul>
<li><code>GET</code> - изисква извличане на ресурс от сървъра;</li>
<li><code>POST</code> - подава данни към сървъра;</li>
</ul>
<p>Други методи, налични в HTTP, включват <code>HEAD</code> (за извличане само на headers на отговора, без ), <code>OPTIONS</code> (за извличане на мета- или допълнителна информация относно ресурса), <code>PUT</code> (за промяна на ресурс), <code>DELETE</code> (за премахване на ресурс от сървъра).</p>
<h3 id="url">URL</h3>
<p>URL (<a href="https://en.wikipedia.org/wiki/Uniform_Resource_Locator">Uniform Resource Locator</a>) е стандарт за представяне на адрес на ресурс.</p>
<p>Най-често в Web URL има следния вид:</p>
<pre><code>    +--------------------------- Протокол / схема                                           
    |                                                                                       
    |     +----------------+---- Host / сървър                                              
    |     |                |                                                                
    |     |                |                                                                
    v     v                v                                                                
   http://python3.softuni.bg/student/lecture/56801680131b1642fba7379d/?started=1&amp;live-view=1
                             ^                                       ^ ^       ^ ^         ^
                             |                                       | |       | |         |
                             |                                       | |       | |         |
  Ресурсен идентификатор ----+---------------------------------------+ |       | |         |
    (или път до ресурса)                                               |       | |         |
                                                                       |       | |         |
             Параметър 1 ----------------------------------------------+-------+ |         |
                                                                                 |         |
             Параметър 2 --------------------------------------------------------+---------+
</code></pre><p><strong>URL не може да съдържа интервал</strong>.</p>
<ul>
<li>Протоколът (или схемата) указва по какъв начин ще бъде достъпен този ресурс. Най-често в Web схемата е http или https;</li>
<li>Host / сървър - указва адрес на сървъра, на който трябва да се достъпи ресурса</li>
<li>Идентификатор на ресурса - в началото на web идентификаторът е представял директно път до файл на файловата система на сървъра; с развитието на web технологиите все по-често това е просто идентификатор, и не задължително на сървъра да съществуват физически такъв файл или директория;</li>
<li>GEТ параметри - като част от URL могат да бъдат подадени допълнителни параметри, често наричани GET параметри; отделят се от иденфитикатора на ресурса с <code>?</code>, и са подредени <code>име на параметър</code>=<code>стойност</code></li>
</ul>
<h3 id="request-headers">Request headers</h3>
<p>Headers представляват информация във вид <code>име на хедър: стойност</code>, която се изпраща заедно със заявката. С помощта на headers клиентът има възможност да укаже допълнителна информация - например какви типове информация може да обработва, какви са езиковите предпочитания, и много други.</p>
<p>Всеки header трябва да бъде на отделен ред. Името на header е отделено от стойността с <code>:</code>.</p>
<h3 id="request-body">Request body</h3>
<p>При методите, които допускат подаване на информация към сървъра - <code>POST</code>, <code>PUT</code>, след края на request headers се подава допълнителен празен ред, след което следва съдържанието на заявката.</p>
<pre><code>POST /login HTTP/1.1
Host: localhost
Content-Length: 31

username=boris&amp;password=python3
</code></pre><h2 id="http-">HTTP отговор</h2>
<pre><code>              +------------------- Версия на HTTP                                
              |                                                                  
              |      +------------ Код / статус на отговора / http response code 
              |      |                                                           
              |      |   +-------- Текстово представяне на статуса на отговора   
              |      |   |                                                       
              |      |   |                                                       
              v      v   v                                                       
           HTTP/1.1 200 OK⏎                                                      
+--------&gt; Server: nginx/1.6.2 (Ubuntu)⏎                                         
|          Content-Type: text/html; charset=UTF-8⏎                               
|          Content-Length: 3336⏎                                                 
+--------&gt; . . . .                                                               
|  +-----&gt; ⏎                                                                     
|  |  +--&gt; &lt;html&gt;                                                                
|  |  |        &lt;head&gt;                                                            
|  |  |            &lt;title&gt;Таковата&lt;/title&gt;                                       
|  |  |            . . . . .                                                     
|  |  |                                                                          
|  |  +--&gt;                                                                       
|  |  |                                                                          
|  |  Съдържание на ресурса                                                      
|  |                                                                             
|  Празен ред - край на response headers и                                       
|  начало на съдържанието на ресурса                                             
|                                                                                
Response headers
</code></pre><h3 id="-http-response-code">Код на отговор / HTTP response code</h3>
<p>Кодът на отговора дава информация как е протекло изпълнението на заявката. Кодовете са трицифрени числа, разделени по групи според смисъла. По-долу са дадени групите , както и най-често използваните response codes</p>
<table>
<thead>
<tr>
<th>Група</th>
<th>Код</th>
<th>Значение</th>
</tr>
</thead>
<tbody>
<tr>
<td>1xx</td>
<td>Информационни статуси</td>
</tr>
<tr>
<td>2xx</td>
</tr>
</tbody>
</table>
<p>200 | OK - заявката е изпълнена успешно, и съдържанието на ресурса е върнато в отговора | | 3xx | 301 | Moved permanently - ресурсът е бил преместен за постоянно | 302 | Found - ресурсът е открит, и трябва да бъде търсен на друг адрес | | 4xx | 400 | Bad request - заявката не е била формулирана правилно, и не е приета | 401 | Unauthorized - клиентът е оторизиран да извика тази заявка | 403 | Forbidden - клиентът няма право да изпълни тази заявка | 404 | Not found - ресурсът не е намерен | | 5xx | 500 | Възникнала е грешка на сървъра при изпълнението на заявката |</p>
<h3 id="headers">Headers</h3>
<ul>
<li>Content-Type - определя <a href="https://en.wikipedia.org/wiki/Media_type">MIME type / media type</a> на върнатия отговор - т.е. какъв тип са върнатите данни - текст, HTML, изображение, Excel документ и т.н.</li>
<li>Content-Length - размер на върнатия отговор в байтове.</li>
</ul>
<h3 id="response-body">Response body</h3>
<p>Обикновено се връща съдръжанието на ресурса, който е бил извикан, но може да бъде и празно - например при HTTP 301</p>
<p>Типът на съдържанието на ресурса се определя от Content-Type</p>
<h2 id="http-python">HTTP клиент с Python</h2>
<p>В стандартната библиотека на Python има HTTP клиент, с който можете да изпълнявате HTTP заявки.</p>
<pre><code>from urllib.request import urlopen

with urlopen('http://www.dir.bg') as response:
    print(r.read())
</code></pre><pre><code>DEMO
</code></pre><h3 id="requests">requests</h3>
<p>requests е външна библиотека, с която HTTP заявките се правят доста по-лесно, особено когато трябва да подавате допълнителни параметри към заявката, да изпращате файлове и т.н.</p>
<pre><code>pip3 install requests
</code></pre><pre><code>import requests

response = requests.get('http://api.fixer.io/latest?symbols=USD,GBP')

....

response = requests.get('http://api.fixer.io/latest', timeout=2.5)   # timeout е в секунди
</code></pre><p>GET параметри с requests:</p>
<pre><code>response = requests.get('http://api.fixer.io/latest', timeout=20, params={'symbols': 'USD,GBP'})   # timeout е в секунди
print(response.url)
</code></pre><h2 id="get-url-escaping">GET параметри и URL escaping</h2>
<p>Специални символи в URL, които задължително трябва да бъдат escaped:</p>
<ul>
<li><code>' '</code> - интервал</li>
<li><code>?</code></li>
<li><code>&amp;</code></li>
<li><code>=</code></li>
</ul>
<h3 id="-">Със средствата на стандартната библиотека</h3>
<p>За да си осугирите, че str стойност ще бъде валидна част от URL, можете да използвате функцията <code>quote</code></p>
<pre><code>from urllib.request import quote

print(quote('Symbols ?, &amp; and =  must be escaped'))
Symbols%20%3F%2C%20%26%20and%20%3D%20%20must%20be%20escaped
</code></pre><h3 id="-requests">С библиотеката requests</h3>
<p>Библиотеката <code>requests</code> автоматично прави escape на подадените данни.</p>
<p>За да изпратите GET параметри с requests, използвайте:</p>
<pre><code>import requests

response = requests.get('http://api.openweathermap.org/data/2.5/weather',    # основен URL
                        params={   # GET параметри - dict
                            'q': 'Sofia',
                            'appid': '965acdac1ae64cf06761bb563ad34d96'
                            },  
                        timeout=20,  # seconds
                        )

# От извикването по-горе, библиотеката ще композира пълния URL:
print(response.url)
http://api.openweathermap.org/data/2.5/weather?q=Sofia&amp;appid=965acdac1ae64cf06761bb563ad34d96
</code></pre><h3 id="-1-56b3712f7e4f59b649b7e5e0-"><a href="@56b3712f7e4f59b649b7e5e0">Задача: 1. Направете прост конвертор на валути</a></h3>
<h3 id="-2-56b38da07e4f59b649b7e5e4-"><a href="@56b38da07e4f59b649b7e5e4">Задача: 2. Какво е времето днес?</a></h3>
<h3 id="-3-56b395237e4f59b64bb7e5e3-"><a href="@56b395237e4f59b64bb7e5e3">Задача: 3. Разширение на конвертора на валути - за дата и подаване на произволни валути</a></h3>
</div>
</body>
</html>
